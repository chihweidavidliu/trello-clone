const a10_0x27b9=['map','../../../utilities/nx-imports','../../../utilities/serializer-overrides','DistributedExecutionApi','NX_CLOUD_DISTRIBUTED_EXECUTION_AGENT_COUNT','createMetricRecorder','/nx-cloud/executions/status','apply','../../../utilities/axios','next','Starting\x20a\x20distributed\x20execution','post','serializeOverrides','dteStart','ciExecutionEnv:\x20','runGroup:\x20','enabled','project','throw','../../../utilities/environment','parallel','createStartRequest','axiosException','value','axiosMultipleTries','message','NX_CLOUD_DISTRIBUTED_EXECUTION_STOP_AGENTS_ON_FAILURE','target','/nx-cloud/executions/complete-run-group','maxParallel','error','exit','note','VERBOSE_LOGGING','status','defineProperty','createApiAxiosInstance','__awaiter','stopAgentsOnFailure','recordMetric','agentCount','done','mapRespToPerfEntry','/nx-cloud/executions/start','hash','then','response','apiAxiosInstance','false','data','RUNNER_FAILURE_PERF_ENTRY'];(function(_0xe96a71,_0x27b977){const _0x5a59be=function(_0x2a9613){while(--_0x2a9613){_0xe96a71['push'](_0xe96a71['shift']());}};_0x5a59be(++_0x27b977);}(a10_0x27b9,0xa1));const a10_0x5a59=function(_0xe96a71,_0x27b977){_0xe96a71=_0xe96a71-0x0;let _0x5a59be=a10_0x27b9[_0xe96a71];return _0x5a59be;};'use strict';var __awaiter=this&&this[a10_0x5a59('0x1d')]||function(_0x139c6b,_0x215184,_0x39bfb6,_0x584e7e){function _0x18f518(_0x1e3194){return _0x1e3194 instanceof _0x39bfb6?_0x1e3194:new _0x39bfb6(function(_0x27dbad){_0x27dbad(_0x1e3194);});}return new(_0x39bfb6||(_0x39bfb6=Promise))(function(_0x16864c,_0x42053e){function _0x4a7396(_0x2aa27a){try{_0x56e516(_0x584e7e[a10_0x5a59('0x1')](_0x2aa27a));}catch(_0x57204c){_0x42053e(_0x57204c);}}function _0x52bb5f(_0x4ed0bb){try{_0x56e516(_0x584e7e[a10_0x5a59('0xa')](_0x4ed0bb));}catch(_0x4b714a){_0x42053e(_0x4b714a);}}function _0x56e516(_0x184b16){_0x184b16[a10_0x5a59('0x21')]?_0x16864c(_0x184b16[a10_0x5a59('0xf')]):_0x18f518(_0x184b16[a10_0x5a59('0xf')])[a10_0x5a59('0x25')](_0x4a7396,_0x52bb5f);}_0x56e516((_0x584e7e=_0x584e7e[a10_0x5a59('0x32')](_0x139c6b,_0x215184||[]))[a10_0x5a59('0x1')]());});};Object[a10_0x5a59('0x1b')](exports,'__esModule',{'value':!![]});exports[a10_0x5a59('0xd')]=exports[a10_0x5a59('0x2e')]=void 0x0;const axios_1=require(a10_0x5a59('0x0'));const environment_1=require(a10_0x5a59('0xb'));const metric_logger_1=require('../../../utilities/metric-logger');const serializer_overrides_1=require(a10_0x5a59('0x2d'));const {output}=require(a10_0x5a59('0x2c'));class DistributedExecutionApi{constructor(_0x288d84){this['apiAxiosInstance']=(0x0,axios_1[a10_0x5a59('0x1c')])(_0x288d84);}['start'](_0x544e82){var _0x7dd91a;return __awaiter(this,void 0x0,void 0x0,function*(){const _0x37a4e2=(0x0,metric_logger_1[a10_0x5a59('0x30')])(a10_0x5a59('0x5'));let _0x4d8220;if(environment_1[a10_0x5a59('0x19')]){output['note']({'title':a10_0x5a59('0x2'),'bodyLines':[JSON['stringify'](_0x544e82,null,0x2)]});}try{_0x4d8220=yield(0x0,axios_1[a10_0x5a59('0x10')])(()=>this[a10_0x5a59('0x27')][a10_0x5a59('0x3')](a10_0x5a59('0x23'),_0x544e82));_0x37a4e2['recordMetric']((0x0,metric_logger_1[a10_0x5a59('0x22')])(_0x4d8220));}catch(_0x1fc21d){_0x37a4e2['recordMetric'](((_0x7dd91a=_0x1fc21d===null||_0x1fc21d===void 0x0?void 0x0:_0x1fc21d[a10_0x5a59('0xe')])===null||_0x7dd91a===void 0x0?void 0x0:_0x7dd91a[a10_0x5a59('0x26')])?(0x0,metric_logger_1[a10_0x5a59('0x22')])(_0x1fc21d[a10_0x5a59('0xe')][a10_0x5a59('0x26')]):metric_logger_1[a10_0x5a59('0x2a')]);throw _0x1fc21d;}if(!_0x4d8220[a10_0x5a59('0x29')][a10_0x5a59('0x8')]){throw new Error('Workspace\x20is\x20disabled.\x20Cannot\x20perform\x20distributed\x20task\x20executions.');}if(_0x4d8220[a10_0x5a59('0x29')][a10_0x5a59('0x16')]){throw new Error(_0x4d8220['data'][a10_0x5a59('0x16')]);}return _0x4d8220[a10_0x5a59('0x29')]['id'];});}[a10_0x5a59('0x1a')](_0x2c3c9b){var _0x3a7892;return __awaiter(this,void 0x0,void 0x0,function*(){const _0x77c70b=(0x0,metric_logger_1['createMetricRecorder'])('dteStatus');try{const _0x59c2f0=yield(0x0,axios_1[a10_0x5a59('0x10')])(()=>this[a10_0x5a59('0x27')][a10_0x5a59('0x3')](a10_0x5a59('0x31'),{'id':_0x2c3c9b}));_0x77c70b['recordMetric']((0x0,metric_logger_1['mapRespToPerfEntry'])(_0x59c2f0));return _0x59c2f0[a10_0x5a59('0x29')];}catch(_0x2452aa){_0x77c70b['recordMetric'](((_0x3a7892=_0x2452aa===null||_0x2452aa===void 0x0?void 0x0:_0x2452aa[a10_0x5a59('0xe')])===null||_0x3a7892===void 0x0?void 0x0:_0x3a7892[a10_0x5a59('0x26')])?(0x0,metric_logger_1['mapRespToPerfEntry'])(_0x2452aa[a10_0x5a59('0xe')][a10_0x5a59('0x26')]):metric_logger_1[a10_0x5a59('0x2a')]);output[a10_0x5a59('0x16')]({'title':_0x2452aa[a10_0x5a59('0x11')]});process[a10_0x5a59('0x17')](0x1);}});}['completeRunGroupWithError'](_0x48c75e,_0x3c27ad,_0x17a464,_0x91f751,_0x2c82ff){var _0x1ce95d;return __awaiter(this,void 0x0,void 0x0,function*(){const _0x5d75ab=(0x0,metric_logger_1[a10_0x5a59('0x30')])('completeRunGroup');if(environment_1[a10_0x5a59('0x19')]){output[a10_0x5a59('0x18')]({'title':'Completing\x20with\x20an\x20error','bodyLines':['ciExecutionId:\x20'+_0x17a464,a10_0x5a59('0x6')+_0x91f751,a10_0x5a59('0x7')+_0x3c27ad,'error:\x20'+_0x2c82ff]});}try{const _0x54f510=yield(0x0,axios_1[a10_0x5a59('0x10')])(()=>this[a10_0x5a59('0x27')][a10_0x5a59('0x3')](a10_0x5a59('0x14'),{'branch':_0x48c75e,'runGroup':_0x3c27ad,'ciExecutionId':_0x17a464,'ciExecutionEnv':_0x91f751,'criticalErrorMessage':_0x2c82ff}),0x3);_0x5d75ab[a10_0x5a59('0x1f')]((0x0,metric_logger_1[a10_0x5a59('0x22')])(_0x54f510));}catch(_0xdf4af1){_0x5d75ab[a10_0x5a59('0x1f')](((_0x1ce95d=_0xdf4af1===null||_0xdf4af1===void 0x0?void 0x0:_0xdf4af1[a10_0x5a59('0xe')])===null||_0x1ce95d===void 0x0?void 0x0:_0x1ce95d[a10_0x5a59('0x26')])?(0x0,metric_logger_1[a10_0x5a59('0x22')])(_0xdf4af1[a10_0x5a59('0xe')][a10_0x5a59('0x26')]):metric_logger_1[a10_0x5a59('0x2a')]);}});}}exports[a10_0x5a59('0x2e')]=DistributedExecutionApi;function createStartRequest(_0xe837e7,_0x3cf2a7,_0x272675,_0x2b5c0e,_0x37c86e,_0x535acc,_0x5106ad){const _0x491c4d=_0x37c86e[a10_0x5a59('0x2b')](_0x571d29=>{return _0x571d29['map'](_0x2531a2=>{return{'taskId':_0x2531a2['id'],'hash':_0x2531a2[a10_0x5a59('0x24')],'projectName':_0x2531a2[a10_0x5a59('0x13')][a10_0x5a59('0x9')],'target':_0x2531a2['target']['target'],'configuration':_0x2531a2[a10_0x5a59('0x13')]['configuration']||null,'params':(0x0,serializer_overrides_1[a10_0x5a59('0x4')])(_0x2531a2)};});});const _0x5c9371={'command':(0x0,environment_1['parseCommand'])(),'branch':_0xe837e7,'runGroup':_0x3cf2a7,'ciExecutionId':_0x272675,'ciExecutionEnv':_0x2b5c0e,'tasks':_0x491c4d,'maxParallel':calculateMaxParallel(_0x535acc),'commitSha':_0x5106ad};if(environment_1[a10_0x5a59('0x2f')]){_0x5c9371[a10_0x5a59('0x20')]=environment_1['NX_CLOUD_DISTRIBUTED_EXECUTION_AGENT_COUNT'];}if(!environment_1[a10_0x5a59('0x12')]){_0x5c9371[a10_0x5a59('0x1e')]=![];}return _0x5c9371;}exports['createStartRequest']=createStartRequest;function calculateMaxParallel(_0x54504f){if(_0x54504f[a10_0x5a59('0xc')]===a10_0x5a59('0x28')||_0x54504f[a10_0x5a59('0xc')]===![]){return 0x1;}else if(_0x54504f[a10_0x5a59('0xc')]==='true'||_0x54504f['parallel']===!![]){return Number(_0x54504f['maxParallel']||0x3);}else if(_0x54504f['parallel']===undefined){return _0x54504f[a10_0x5a59('0x15')]?Number(_0x54504f['maxParallel']):0x3;}else{return Number(_0x54504f[a10_0x5a59('0xc')])||0x3;}}