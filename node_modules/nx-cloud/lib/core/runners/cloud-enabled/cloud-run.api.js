const a3_0x24e8=['getRunGroup','createMetricRecorder','data','__awaiter','Run\x20Details:','Run\x20completion\x20responded\x20with\x20`undefined`.','../../../utilities/nx-imports','startRun','package.json','message','status','/nx-cloud/runs/end','error','apiError','RUNNER_FAILURE_PERF_ENTRY','RunEnd\x20duration','stringify','nxCloudVersion','response','RunStart','axiosException','from','urls','next','devDependencies','isConnectedToPrivateCloud','runContext','getCIExecutionEnv','api','/nx-cloud/runs/start','../../../utilities/metric-logger','printDuration','getCIExecutionId','CloudRunApi','runUrl','nx-cloud','readFileSync','promisify','defaults','createReqBody','Invalid\x20end\x20run\x20response','VERBOSE_LOGGING','map','headers','recordMetric','note','getBranch','success','machineInfo','uploadedToStorage','mapRespToPerfEntry','done','throw','../../../utilities/environment','messages','axiosMultipleTries','endRun','Invalid\x20Nx\x20Cloud\x20response:\x20','assign','post','toString','RunStart\x20duration','application/octet-stream','parse','stack','RunEnd.\x20Completed\x20tasks','apiAxiosInstance','apply','extractErrorMessage','gzip','length','unknown','Invalid\x20end\x20run\x20response:\x20','string','then','terminalOutput','defineProperty','util'];(function(_0x13b2c3,_0x24e884){const _0x5b9a57=function(_0x392d50){while(--_0x392d50){_0x13b2c3['push'](_0x13b2c3['shift']());}};_0x5b9a57(++_0x24e884);}(a3_0x24e8,0xb6));const a3_0x5b9a=function(_0x13b2c3,_0x24e884){_0x13b2c3=_0x13b2c3-0x0;let _0x5b9a57=a3_0x24e8[_0x13b2c3];return _0x5b9a57;};'use strict';var __awaiter=this&&this[a3_0x5b9a('0x37')]||function(_0x28e754,_0x394e8e,_0x4a5fca,_0x523218){function _0x458ac5(_0x5bde4f){return _0x5bde4f instanceof _0x4a5fca?_0x5bde4f:new _0x4a5fca(function(_0x2334da){_0x2334da(_0x5bde4f);});}return new(_0x4a5fca||(_0x4a5fca=Promise))(function(_0x2e8a5e,_0x17cfb7){function _0x3431b6(_0x54cc28){try{_0x56fd4a(_0x523218[a3_0x5b9a('0x4b')](_0x54cc28));}catch(_0x2c90c2){_0x17cfb7(_0x2c90c2);}}function _0x94a57b(_0x5c6e4e){try{_0x56fd4a(_0x523218[a3_0x5b9a('0x1a')](_0x5c6e4e));}catch(_0x2c476a){_0x17cfb7(_0x2c476a);}}function _0x56fd4a(_0x3bee22){_0x3bee22[a3_0x5b9a('0x19')]?_0x2e8a5e(_0x3bee22['value']):_0x458ac5(_0x3bee22['value'])[a3_0x5b9a('0x30')](_0x3431b6,_0x94a57b);}_0x56fd4a((_0x523218=_0x523218[a3_0x5b9a('0x29')](_0x28e754,_0x394e8e||[]))[a3_0x5b9a('0x4b')]());});};Object[a3_0x5b9a('0x32')](exports,'__esModule',{'value':!![]});exports[a3_0x5b9a('0x7')]=void 0x0;const axios_1=require('../../../utilities/axios');const environment_1=require(a3_0x5b9a('0x1b'));const fs_1=require('fs');const zlib_1=require('zlib');const util_1=require(a3_0x5b9a('0x33'));const metric_logger_1=require(a3_0x5b9a('0x4'));const is_private_cloud_1=require('../../../utilities/is-private-cloud');const {output}=require(a3_0x5b9a('0x3a'));class CloudRunApi{constructor(_0x30e0a3,_0x1afd76,_0x1468ae,_0x1d8e59){this[a3_0x5b9a('0x1c')]=_0x30e0a3;this[a3_0x5b9a('0x0')]=_0x1afd76;this[a3_0x5b9a('0x16')]=_0x1d8e59;this[a3_0x5b9a('0x28')]=(0x0,axios_1['createApiAxiosInstance'])(_0x1468ae);}[a3_0x5b9a('0x3b')](_0x1025e1,_0x5b2c62){var _0x417ab3;return __awaiter(this,void 0x0,void 0x0,function*(){if(this[a3_0x5b9a('0x1c')]['apiError'])return{};const _0xd5f917=(0x0,metric_logger_1[a3_0x5b9a('0x35')])(a3_0x5b9a('0x3b'));try{const _0x4a5e65={'meta':{'nxCloudVersion':this[a3_0x5b9a('0x45')]()},'branch':(0x0,environment_1[a3_0x5b9a('0x14')])(),'runGroup':(0x0,environment_1[a3_0x5b9a('0x34')])(),'ciExecutionId':(0x0,environment_1[a3_0x5b9a('0x6')])(),'ciExecutionEnv':(0x0,environment_1[a3_0x5b9a('0x1')])(),'distributedExecutionId':_0x1025e1,'hashes':_0x5b2c62,'machineInfo':this[a3_0x5b9a('0x16')]};if(environment_1[a3_0x5b9a('0xf')]){output[a3_0x5b9a('0x13')]({'title':a3_0x5b9a('0x47'),'bodyLines':['\x0a'+JSON[a3_0x5b9a('0x44')](_0x4a5e65,null,0x2)]});}const _0x2bfc5a=yield(0x0,axios_1['printDuration'])(a3_0x5b9a('0x23'),()=>(0x0,axios_1[a3_0x5b9a('0x1d')])(()=>this['apiAxiosInstance'][a3_0x5b9a('0x21')](a3_0x5b9a('0x3'),_0x4a5e65)));_0xd5f917[a3_0x5b9a('0x12')]((0x0,metric_logger_1[a3_0x5b9a('0x18')])(_0x2bfc5a));if(_0x2bfc5a[a3_0x5b9a('0x36')]&&_0x2bfc5a[a3_0x5b9a('0x36')]['message']){this['messages'][a3_0x5b9a('0x3d')]=_0x2bfc5a[a3_0x5b9a('0x36')][a3_0x5b9a('0x3d')];}if(!_0x2bfc5a['data']||!_0x2bfc5a['data'][a3_0x5b9a('0x4a')]){this[a3_0x5b9a('0x1c')][a3_0x5b9a('0x41')]=a3_0x5b9a('0x1f')+JSON[a3_0x5b9a('0x44')](_0x2bfc5a['data']);return{};}return _0x2bfc5a[a3_0x5b9a('0x36')][a3_0x5b9a('0x4a')];}catch(_0x3dc3af){_0xd5f917['recordMetric'](((_0x417ab3=_0x3dc3af===null||_0x3dc3af===void 0x0?void 0x0:_0x3dc3af[a3_0x5b9a('0x48')])===null||_0x417ab3===void 0x0?void 0x0:_0x417ab3['response'])?(0x0,metric_logger_1['mapRespToPerfEntry'])(_0x3dc3af[a3_0x5b9a('0x48')]['response']):metric_logger_1[a3_0x5b9a('0x42')]);this[a3_0x5b9a('0x1c')]['apiError']=this[a3_0x5b9a('0x1c')][a3_0x5b9a('0x2a')](_0x3dc3af,a3_0x5b9a('0x2'));return{};}});}[a3_0x5b9a('0xd')](_0x848a1f,_0x36e6c9,_0x6838df,_0x15fbbb){if((0x0,is_private_cloud_1[a3_0x5b9a('0x4d')])()){for(let _0x23b118 of _0x36e6c9){delete _0x23b118[a3_0x5b9a('0x17')];}}const _0x3fbbad=Object['assign'](Object[a3_0x5b9a('0x20')]({'meta':{'nxCloudVersion':this[a3_0x5b9a('0x45')]()},'tasks':_0x36e6c9,'run':_0x848a1f,'linkId':_0x15fbbb},(0x0,is_private_cloud_1[a3_0x5b9a('0x4d')])()?{}:_0x6838df),{'machineInfo':this['machineInfo']});return JSON[a3_0x5b9a('0x44')](_0x3fbbad);}[a3_0x5b9a('0x1e')](_0x3d56af,_0x16f491,_0x57638e,_0x1009a2){var _0x2b4e18,_0x53b339;return __awaiter(this,void 0x0,void 0x0,function*(){if(this['messages'][a3_0x5b9a('0x41')])return![];let _0x1aea04=this[a3_0x5b9a('0xd')](_0x3d56af,_0x16f491,_0x57638e,_0x1009a2);if(_0x1aea04[a3_0x5b9a('0x2c')]>0x14*0x3e8*0x3e8){_0x1aea04=this[a3_0x5b9a('0xd')](_0x3d56af,_0x16f491[a3_0x5b9a('0x10')](_0x4ceb57=>Object[a3_0x5b9a('0x20')](Object[a3_0x5b9a('0x20')]({},_0x4ceb57),{'hashDetails':undefined})),_0x57638e,_0x1009a2);}const _0x5506c3=Buffer[a3_0x5b9a('0x49')](_0x1aea04);const _0x2ba752=yield(0x0,util_1[a3_0x5b9a('0xb')])(zlib_1[a3_0x5b9a('0x2b')])(_0x5506c3);const _0xe63038=(0x0,metric_logger_1['createMetricRecorder'])(a3_0x5b9a('0x1e'));try{if(environment_1[a3_0x5b9a('0xf')]){const _0x5063db=_0x16f491[a3_0x5b9a('0x10')](_0x5b5d76=>{return Object[a3_0x5b9a('0x20')](Object[a3_0x5b9a('0x20')]({},_0x5b5d76),{'terminalOutput':_0x5b5d76[a3_0x5b9a('0x31')]?_0x5b5d76[a3_0x5b9a('0x31')]['slice'](0x0,0x14)+'...':undefined});});output[a3_0x5b9a('0x13')]({'title':a3_0x5b9a('0x27'),'bodyLines':['\x0a'+JSON[a3_0x5b9a('0x44')](_0x5063db,null,0x2)]});}const _0x5b9765=yield(0x0,axios_1[a3_0x5b9a('0x5')])(a3_0x5b9a('0x43'),()=>(0x0,axios_1[a3_0x5b9a('0x1d')])(()=>this[a3_0x5b9a('0x28')][a3_0x5b9a('0x21')](a3_0x5b9a('0x3f'),_0x2ba752,{'headers':Object['assign'](Object[a3_0x5b9a('0x20')]({},this['apiAxiosInstance'][a3_0x5b9a('0xc')][a3_0x5b9a('0x11')]),{'Content-Encoding':a3_0x5b9a('0x2b'),'Content-Type':a3_0x5b9a('0x24')})})));if(_0x5b9765){_0xe63038['recordMetric']((0x0,metric_logger_1[a3_0x5b9a('0x18')])(_0x5b9765));if(_0x5b9765[a3_0x5b9a('0x36')]&&_0x5b9765[a3_0x5b9a('0x36')][a3_0x5b9a('0x8')]&&_0x5b9765['data']['status']===a3_0x5b9a('0x15')){this[a3_0x5b9a('0x0')][a3_0x5b9a('0x8')]=_0x5b9765[a3_0x5b9a('0x36')][a3_0x5b9a('0x8')];return!![];}if(_0x5b9765[a3_0x5b9a('0x36')]&&_0x5b9765[a3_0x5b9a('0x36')][a3_0x5b9a('0x3e')]){this[a3_0x5b9a('0x1c')][a3_0x5b9a('0x41')]='Invalid\x20end\x20run\x20response:\x20'+JSON['stringify'](_0x5b9765['data']['message']);}else if(_0x5b9765[a3_0x5b9a('0x36')]&&typeof _0x5b9765[a3_0x5b9a('0x36')]===a3_0x5b9a('0x2f')){if(_0x5b9765['data']!==a3_0x5b9a('0x15')){this[a3_0x5b9a('0x1c')]['apiError']='Invalid\x20end\x20run\x20response:\x20'+JSON[a3_0x5b9a('0x44')](_0x5b9765[a3_0x5b9a('0x36')]);}}else{this['messages']['apiError']=a3_0x5b9a('0x2e')+JSON[a3_0x5b9a('0x44')](_0x5b9765[a3_0x5b9a('0x36')]);}if(environment_1[a3_0x5b9a('0xf')]){output[a3_0x5b9a('0x13')]({'title':a3_0x5b9a('0xe'),'bodyLines':[JSON['stringify'](_0x5b9765[a3_0x5b9a('0x36')],null,0x2)]});}}else{output[a3_0x5b9a('0x40')]({'title':'Nx\x20Cloud:\x20Unknown\x20Error\x20Occurred','bodyLines':[a3_0x5b9a('0x39'),a3_0x5b9a('0x38'),JSON[a3_0x5b9a('0x44')](_0x3d56af,null,0x2),'Stack\x20Trace:',JSON[a3_0x5b9a('0x44')](new Error()[a3_0x5b9a('0x26')],null,0x2)]});}return![];}catch(_0x3905ab){_0xe63038[a3_0x5b9a('0x12')](((_0x2b4e18=_0x3905ab===null||_0x3905ab===void 0x0?void 0x0:_0x3905ab[a3_0x5b9a('0x48')])===null||_0x2b4e18===void 0x0?void 0x0:_0x2b4e18[a3_0x5b9a('0x46')])?(0x0,metric_logger_1[a3_0x5b9a('0x18')])(_0x3905ab[a3_0x5b9a('0x48')][a3_0x5b9a('0x46')]):metric_logger_1[a3_0x5b9a('0x42')]);const _0x61f80=(_0x53b339=_0x3905ab['axiosException'])!==null&&_0x53b339!==void 0x0?_0x53b339:_0x3905ab;this[a3_0x5b9a('0x1c')][a3_0x5b9a('0x41')]=this[a3_0x5b9a('0x1c')][a3_0x5b9a('0x2a')](_0x61f80,a3_0x5b9a('0x2'));return![];}});}[a3_0x5b9a('0x45')](){try{const _0x119e5e=JSON[a3_0x5b9a('0x25')]((0x0,fs_1[a3_0x5b9a('0xa')])(a3_0x5b9a('0x3c'))[a3_0x5b9a('0x22')]());return _0x119e5e['devDependencies'][a3_0x5b9a('0x9')]||_0x119e5e[a3_0x5b9a('0x4c')]['@nrwl/nx-cloud'];}catch(_0x1d77b8){return a3_0x5b9a('0x2d');}}}exports[a3_0x5b9a('0x7')]=CloudRunApi;